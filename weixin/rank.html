<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <meta name="format-detection" content="telephone=no">
    <title>我的排名</title>
    <link type="text/css" rel="stylesheet" href="css/base.css">

    <link type="text/css" rel="stylesheet" href="css/main.css">
    <link type="text/css" rel="stylesheet" href="css/icon-main.css">
</head>
<body class="bg-rank-main">
    <section class="container">
        <header class="header">
            <div class="rel title">
                <a class="flt color-top" href="javascript:history.go(-1)"> <span class="icon-back"></span>&nbsp;&nbsp;</a>
                <div class="flt" id="top-drop">
                    <span class="flt">我的排名</span>               
                </div>
                <div class="clear"></div>
            </div>
        </header>
        <section class="rank">
            <div class="rank-index">
                <div class="rank-circle">
                    <div class="rank-circle-mar">
                        <div class="circle-bg rel" id="circle-bg">
                            <canvas class="abs circle-cent" width="180" height="180" id="circle-cent"></canvas>
                            <div class="rank-circle-txt align-c">
                                <p class="mar-64 f12">截止3月25日已挣</p>
                                <p class="f30 yellow" id="my-score" data-myscore="223">0</p>
                                <p class="f12">公司平均分值5620分</p>
                                <p class="mar-16 f10">部门排名</p>
                                <p class="f12 white line-hgt20">第<span class="f16">3</span>名</p>
                                <p class="mar-6 f10">距离上一个名次还差100分，加速！</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="rank-score f10 white">
                    <div class="rank-score-title rel">
                        <span class="flt">最近7天</span>
                        <span class="frl">平均<span id="average">50</span>天/分</span>
                        <div class="clear"></div>
                        <div class="rank-dotted-line abs"></div>
                    </div>
                    <ul class="rank-score-detail" id="rank-score-detail">
                        <li class="flt rank-score-list"><span class="rank-score-bar" data-val="100"></span></li>
                        <li class="flt rank-score-list"><span class="rank-score-bar" data-val="45"></span></li>
                        <li class="flt rank-score-list"><span class="rank-score-bar" data-val="67"></span></li>
                        <li class="flt rank-score-list"><span class="rank-score-bar" data-val="34"></span></li>
                        <li class="flt rank-score-list"><span class="rank-score-bar" data-val="55"></span></li>
                        <li class="flt rank-score-list"><span class="rank-score-bar" data-val="66"></span></li>
                        <li class="flt rank-score-list"><span class="rank-score-bar" data-val="0"></span></li>
                    </ul>
                    <div class="clear"></div>
                    <div class="rank-score-day">
                        <span class="flt rank-score-list">1日</span>
                        <span class="flt rank-score-list">2日</span>
                        <span class="flt rank-score-list">3日</span>
                        <span class="flt rank-score-list">4日</span>
                        <span class="flt rank-score-list">5日</span>
                        <span class="flt rank-score-list">6日</span>
                        <span class="flt rank-score-list">7日</span>
                    </div>
                    <div class="clear"></div>
                </div>
                <div class="clear"></div>
                <table class="rank-table f14 white">
                    <tr class="rank-tr"><td>1</td><td>孙双</td><td>255分</td></tr>
                    <tr class="rank-tr blue"><td>2</td><td>我</td><td>255分</td></tr>
                    <tr class="rank-tr"><td>3</td><td>啊不错的</td><td>255分</td></tr>
                </table>
            </div>
            <div class="clear"></div>
            <nav class="btm-menu bg-white align-c">
                <a class="btm-menu-a" href="rank-total.html">
                    <div class="rank-btm-icon">
                        <span class="icon-jd f30"></span>
                    </div>
                    <span class="f10">总分排名</span>
                </a>
                <a class="btm-menu-a btm-menu-b" href="rank-month.html">
                    <div class="rank-btm-icon">
                        <span class="f30 icon-yd"> </span>
                    </div>
                    <span class="f10">月度排名</span>
                </a>
                <a class="btm-menu-a" href="rank-stage.html">
                    <div class="rank-btm-icon">
                        <span class="icon-zf f30"></span>
                    </div>
                    <span class="f10">阶段排名</span>
                </a>
            </nav>
        </section>
    </section>
    <script type="text/javascript" src="js/zepto.min.js"></script>
    <script>
        Zepto(function($){
            /*圆形显示百分比*/
            (function(){
                var circleBg = document.getElementById("circle-bg");
                var myScore = 144;  //我的分数
                var lastScore = 170; //上一个名次的分数
                var lastPercent = (myScore/lastScore).toFixed(2);

                var c=document.getElementById("circle-cent");
                var ctx=c.getContext("2d");
                /*绘制背景圆*/
                ctx.strokeStyle = "#44505e";
                ctx.lineWidth = 10;
                ctx.beginPath();
                ctx.arc(90,90,80,0.65*Math.PI,2.35*Math.PI);
                ctx.stroke();

                /*百分比的圆显示动画*/
                var start = 0.65;
                var end = (2.35-0.65)*lastPercent+0.65;
                var t = setInterval(function(){
                    start+=0.01;
                    circle(start-0.02,start);
                    if(start>end){
                        clearInterval(t);
                    }
                },1);
                /*绘制表示百分比的圆*/
                var grad  = ctx.createLinearGradient(0,180,180,180);
                // 指定渐变颜色
                grad.addColorStop(0,'rgb(103, 240, 240)');
                grad.addColorStop(0.8,'rgb(155, 155, 248)');

                function circle(start,end){
                    //ctx.strokeStyle = "#66d2d5";
                    ctx.strokeStyle=grad;
                    ctx.lineWidth = 10;
                    ctx.beginPath();
                    //ctx.arc(90,90,80,0.65*Math.PI,2.35*Math.PI);
                    ctx.arc(90,90,80,start*Math.PI,end*Math.PI);
                    ctx.stroke();
                }
            })();

            /*我的分数动画*/
            (function(){
                var myScoreOb = $("#my-score");
                var myScore = parseInt($("#my-score").data('myscore'));
                var myScoreInit = 0;
                var tScore = setInterval(function(){
                    myScoreInit++;
                    myScoreOb.html(myScoreInit);
                    if(myScoreInit>=myScore){
                        clearInterval(tScore);
                    }
                },0);
            })();

            /*近七天的柱形图显示*/
            (function(){
                var h = parseInt($("#rank-score-detail").css("height"))/2;  //获取平均高度
                var average = parseInt($("#average").text());  //获取平均分
                $("#rank-score-detail .rank-score-bar").each(function(){
                    var score = $(this).data("val");
                    var percent = (score/average).toFixed(2);
                    var scoreH = parseInt(percent*h);
                    $(this).css("height",scoreH+"px");
                });
            })();

            (function(){
                $(".rank").swipe(function(e){
                    e.preventDefault();
                });
            })();
        });
    </script>
</body>
</html>